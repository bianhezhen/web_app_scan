# encoding: UTF-8

import nmap


def NmapPortServiceScan(host, speed="-T4", noPing=True, portRange="80"):
    lines = ""

    nm = nmap.PortScanner()

    args = "-sT %s " % speed

    if noPing:
        args += "-Pn"

    nm.scan(hosts=host, ports=portRange, arguments=args, sudo=False)
    # print nm.command_line()
    csv = nm.csv()

    lineList = csv.split("\r\n")

    lineList = lineList[1:]
    for line in lineList:
        lines += line + "\r\n"

    return lines

if __name__ == "__main__":
    hosts = [
        '10.150.166.93',
        '10.150.166.74',
        '10.150.166.78',
        '10.150.166.79',
        '10.150.166.101',
        '10.191.10.22',
        '10.191.15.45',
        '10.150.163.237',
        '10.150.165.168',
        '10.150.165.82',
        '10.150.163.235',
        '10.150.163.236',
        '10.193.0.228',
        '10.193.5.48',
        '10.194.1.248',
        '10.193.2.107',
        '10.193.7.80',
        '10.194.6.238',
        '10.193.10.28',
        '10.193.10.29',
        '10.193.10.45',
        '10.193.10.88',
        '10.193.10.100',
        '10.206.131.54',
        '10.194.146.218',
        '10.191.7.224',
        '10.206.5.32',
        '10.206.5.210',
        '10.206.9.110',
        '10.206.9.42',
        '10.206.8.230',
        '10.206.8.102',
        '10.206.8.34',
        '10.206.6.18',
        '10.206.5.206',
        '10.206.5.98',
        '10.206.5.22',
        '10.206.5.23',
        '10.206.9.178',
        '10.206.8.97',
        '10.206.8.98',
        '10.206.2.170',
        '10.206.2.98',
        '10.206.1.240',
        '10.206.1.241',
        '10.206.1.242',
        '10.206.1.168',
        '10.206.1.169',
        '10.206.1.170',
        '10.206.1.96',
        '10.206.1.97',
        '10.206.1.98',
        '10.206.3.164',
        '10.206.3.165',
        '10.206.3.166',
        '10.206.3.112',
        '10.206.3.113',
        '10.206.3.114',
        '10.206.4.222',
        '10.206.4.154',
        '10.206.4.90',
        '10.206.4.91',
        '10.206.9.242',
        '10.206.9.173',
        '10.206.9.174',
        '10.206.9.113',
        '10.206.9.114',
        '10.206.9.33',
        '10.206.3.233',
        '10.206.3.234',
        '10.206.3.162',
        '10.206.1.50',
        '10.191.14.78',
        '10.191.139.24',
        '10.191.139.25',
        '10.217.252.220',
        '10.217.252.221',
        '10.217.252.221',
        '10.226.129.89',
        '10.226.129.90',
        '10.217.143.5',
        '10.239.168.85',
        '10.239.168.70',
        '10.239.168.81',
        '10.239.168.64',
        '10.239.168.76',
        '10.239.168.54',
        '10.239.168.58',
        '10.239.168.7',
    ]
    csvHeader = "Host;Protocol;Port;Name;State;"
    csvHeader += "Product;Extrainfo;Reason;Version;Conf;CPE\n\r"
    fileName = "NmapScan.csv"
    scanFile = open(fileName, "w").close()
    scanFile = open(fileName, "a")
    scanFile.write(csvHeader)

    for host in hosts:
        lines = NmapPortServiceScan(host)

        scanFile.write(lines)

    scanFile.close()
